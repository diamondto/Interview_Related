# 从输入 URL 到页面展示，这中间发生了什么？越细越好  
- 多进程架构  
- IPC(Inter-Process Communication 进程间通信)  

1. 注重细节  
2. 从想当然到理所应当，V8 引擎及浏览器架构  
3. 全面考察前端是否具有完整计算机本科学习能力的代表题  
  web 开发 + 网络 + 操作系统  
4. 如何规范的回答  
  有条理，进程是主脉络  

## 动手实操  
1. 浏览器 上网的 proxy，通过浏览器来代理我们访问网页  
  可以当搜索框来用，使用默认的搜索引擎  
  url  
  juejin.im 补全为 https://juejin.im/ 用户体验做的很好，**补全协议**  
2. 浏览器中，操作系统里的进程  
  细节，像代码架构分层，流程细化  
  web 访问，浏览器 chrome 多进程的架构模式，最流畅，用更多的内存，比 IE 优秀  
  **打开一个页面 至少有 4 个进程**  
  <!-- 主进程 --- 管家，chrome 浏览器进程  
  子进程：  
    + GPU 进程 --- 渲染进程，GPU 加速 --- 3D 渲染，css transform3d  
    + NetWork Service  
    + 标签页   -->
## 前提回答
chrome 多进程架构带来现代浏览器的快速访问体验，chrome 就是代表  
  - 浏览器主进程 并发  
    + 启动浏览器，提供交互(url 输入)  
    + 子进程管理(进程间通信 IPC)  
    + 文件存储功能 --- 文件缓存 cookie localStorage... BOM  
  - 渲染进程  
    将请求回来的 html、css、js、图片等，解析成为可交互的页面  
    渲染进程所有的内容都是通过网络获取的，会存在一些恶意代码利用浏览器漏洞对系统进行攻击，所以运行在渲染进程里面的代码是不被信任的。这也是为什么 Chrome 会让渲染进程运行在安全沙箱里，就是为了保证系统的安全  
  - 网络进程  
    面向渲染进程和浏览器进程等提供网络下载功能  
  - 标签页  
  
  把 url 给网络进程，拿到数据后给渲染进程，涉及进程间的通信  
  并行执行  
## 执行过程  
  访问过程，问题回答清楚，把执行流程解释清楚，进程间的流程  
  1. 浏览器进程接收到用户输入的 URL 请求时，**在主进程上，IPC 进程间通信将 URL 交给网络进程**  

  2. **网络进程中发起真正的 URL 请求**，请求是由 c++ 模块  
    2.1 request  
    2.2 response  
  - DNS 解析  
    DNS(Domain Name System) 服务器 domain 域名 -> 获取服务器 IP 地址，如果请求协议是 HTTPS，那么还需要建立 TLS 连接  
  - 网络协议 TCP HTTP  
    首先，网络进程会查找本地缓存是否缓存了该资源  
    如果有缓存资源，那么直接返回资源给浏览器进程  
    如果在缓存中没有查找到资源，那么直接进入网络请求流程  
  - 接下来就是利用 IP 地址和服务器建立 TCP 连接  
    连接建立之后，浏览器端会构建请求行、请求头等信息，并把和该域名相关的 Cookie 等数据附加到请求头中，然后向服务器发送构建的请求信息  
  - 服务器接收到请求信息后，会根据请求信息生成响应数据（包括响应行、响应头和响应体等信息），并发给网络进程。

  3. 网络进程 `响应头` 数据(响应：响应头 + 响应体) `通知渲染进程开始准备干活`  
    过程：  
      text/html text/json image/jpg  提前通知渲染？ `把响应头数据解析，转发给浏览器进程`  
    **解析响应头：**  
    网络进程接收到服务器发送的响应行和响应头之后，就开始解析响应头的内容，如果发现返回的状态码是 301 或 302 的时候，说明服务器需要浏览器重定向到其他 URL，这时网络进程会从响应头的 Location 字段里面读取重定向的地址，然后再发起新的 HTTP 或者 HTTPS 请求，一切又重头开始了  
  - 浏览器进程(主进程)接收到网络进程的响应头消息之后**提交导航消息(CommitNavigation)到渲染进程**，告诉它要准备接收数据  

  4. **渲染进程收到提交的导航信息后**，开始准备接收 HTML 数据，直接和网络进程建立数据管道  

  5. **最后渲染进程会向浏览器进程发送确认提交**，告诉浏览器进程已经准备好接收和解析页面数据  

  6. body 到了，因为已经建立了数据管道，所以数据会直接到渲染进程，渲染进程进行渲染  
    **如果是从原来的URL来到新的页面**，比如 target = self 的情况，移除之前的页面(比如豆瓣)，页面的重绘和重排，**提交确定文档消息**给浏览器进程，告诉主进程要移除原来的文档并进行更新进程中页面状态  
    